<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ç¬¬äº”é—œï¼šåœ°ç„æ™ºæ…§æŒ‘æˆ°ğŸ”¥</title>
<style>
  body {
    margin:0; padding:0;
    font-family:"Microsoft JhengHei", sans-serif;
    background: url('images/background1.jpg') no-repeat center center fixed;
    background-size: cover;
    color:#222;
    display:flex; justify-content:center; align-items:center;
    height:100vh;
  }
  #game {
    position: relative;
    background: rgba(255,255,255,0.95);
    border-radius: 20px;
    width: 90%;
    max-width: 600px;
    padding: 25px 30px;
    box-shadow: 0 0 30px #b71c1c;
    text-align:center;
    overflow: hidden;
  }
  h1 {
    color:#b71c1c;
    margin-bottom: 15px;
    font-size: 2.2rem;
    user-select:none;
  }
  #boss {
    background: rgba(0,0,0,0.85);
    color: #f44336;
    font-style: italic;
    border-radius: 15px;
    padding: 14px 20px;
    margin-bottom: 18px;
    font-size: 1.2rem;
    min-height: 45px;
    user-select:none;
    transition: color 0.3s ease, text-shadow 0.3s ease;
  }
  #timer {
    font-weight: bold;
    color: #d32f2f;
    margin-bottom: 15px;
    font-size: 1.3rem;
    user-select:none;
  }
  #scoreBox {
    font-weight: bold;
    margin-bottom: 20px;
    font-size: 1.15rem;
    user-select:none;
  }
  #question {
    font-size: 1.4rem;
    margin-bottom: 18px;
    min-height: 60px;
  }
  button.option {
    display: block;
    background: linear-gradient(145deg, #ff6f91, #ff91a4);
    border: none;
    border-radius: 20px;
    box-shadow: 3px 3px 8px #d6497a, -3px -3px 8px #ffb6c1;
    color: #fff;
    font-size: 1.1rem;
    margin: 9px auto;
    padding: 12px 18px;
    cursor: pointer;
    max-width: 100%;
    transition: all 0.3s ease;
    user-select:none;
  }
  button.option:hover {
    background: linear-gradient(145deg, #ff91a4, #ff6f91);
    box-shadow: 0 0 15px #ff456e;
  }
  #inputArea {
    margin: 15px 0;
  }
  #inputArea input {
    font-size: 1.1rem;
    padding: 10px;
    width: 80%;
    max-width: 320px;
    border-radius: 15px;
    border: 2px solid #b71c1c;
    outline: none;
  }
  #inputArea input:focus {
    border-color: #ff456e;
    box-shadow: 0 0 8px #ff456e;
  }
  #inputArea button {
    padding: 10px 16px;
    font-size: 1.1rem;
    border-radius: 15px;
    border:none;
    background: #b71c1c;
    color:#fff;
    margin-left: 12px;
    cursor: pointer;
    user-select:none;
  }
  #message {
    margin-top: 22px;
    min-height: 28px;
    font-weight: bold;
    font-size: 1.2rem;
  }

  /* å¯æ„›é¢¨æ ¼æŒ‰éˆ• */
  button.option {
    user-select:none;
  }
  button.option:hover {
    user-select:none;
  }

  /* å€’æ•¸10ç§’èƒŒæ™¯é–ƒçˆ */
  @keyframes redGlow {
    0%, 100% { box-shadow: 0 0 15px #ff3b3b; }
    50% { box-shadow: 0 0 35px #ff0000; }
  }
  #game.countdown {
    animation: redGlow 1s infinite alternate;
  }

  /* éŒ¯èª¤æ¨¡ç³Šæ™ƒå‹• */
  @keyframes shakeBlur {
    0%, 100% { filter: blur(0); transform: translate(0,0); }
    25% { filter: blur(2px); transform: translate(-5px,5px); }
    50% { filter: blur(4px); transform: translate(5px,-5px); }
    75% { filter: blur(2px); transform: translate(-3px,3px); }
  }
  .shakeBlur {
    animation: shakeBlur 0.5s 3;
  }

  /* BOSSç«ç„°çˆ†è£‚æ–‡å­— */
  @keyframes fireBurst {
    0% { color: #f44336; text-shadow: 0 0 10px #ff5722; }
    50% { color: #ff1744; text-shadow: 0 0 25px #ff8a80, 0 0 30px #ff5252; }
    100% { color: #f44336; text-shadow: 0 0 10px #ff5722; }
  }
  .fireBurst {
    animation: fireBurst 1s ease-in-out 3;
  }

  /* å½©å¸¶çˆ†è£‚å‹•ç•« (ç­”å°ç‰¹æ•ˆ) */
  @keyframes confettiDrop {
    0% { opacity: 0; transform: translateY(-20px) rotate(0deg); }
    50% { opacity: 1; transform: translateY(10px) rotate(360deg); }
    100% { opacity: 0; transform: translateY(100px) rotate(720deg); }
  }
  .confetti {
    position: absolute;
    width: 10px;
    height: 10px;
    background-color: #ff4081;
    opacity: 0;
    animation: confettiDrop 1s forwards;
    border-radius: 50%;
    pointer-events: none;
    user-select:none;
  }
</style>
</head>
<body>
<div id="game">
  <h1>ğŸ”¥ åœ°ç„æ™ºæ…§æŒ‘æˆ°ï¼ˆç¬¬äº”é—œï¼‰ğŸ”¥</h1>
  <div id="boss">ğŸ‘¿ BOSSï¼šæº–å‚™å¥½è¢«ç‡’è…¦äº†å—ï¼Ÿ</div>
  <div id="timer">å‰©é¤˜æ™‚é–“ï¼š45ç§’</div>
  <div id="scoreBox">åˆ†æ•¸ï¼š0 | éŒ¯èª¤æ¬¡æ•¸ï¼š0/3</div>
  <div id="question"></div>
  <div id="options"></div>
  <div id="inputArea" style="display:none;">
    <input type="text" id="textAnswer" placeholder="è«‹è¼¸å…¥ç­”æ¡ˆ..." autocomplete="off" />
    <button onclick="submitTextAnswer()">æäº¤</button>
  </div>
  <div id="message"></div>
</div>

<script>
// ==== BOSS å˜²è«·èªå¥ï¼ˆåœ°ç„é­”ç‹é¢¨ï¼‰====
const bossLines = [
  "å“¼å“¼å“¼ï¼Œé€™é¡Œä¸å¯èƒ½æœ‰äººç­”å¾—å°ï¼",
  "ä½ çœŸçš„ä»¥ç‚ºé€™é¡Œç°¡å–®ï¼Ÿé†’é†’å§ï¼",
  "ç­”éŒ¯ä¸€æ¬¡æˆ‘éƒ½æ›¿ä½ é›£éï¼",
  "å“ˆå“ˆå“ˆï¼Œé‚„æ•¢æŒ‘æˆ°ï¼Ÿ",
  "åˆ¥è‡ªæ¬ºæ¬ºäººäº†ï¼Œä½ æ’ä¸éå»ï¼",
  "æˆ‘å·²ç¶“é–‹å§‹å˜²ç¬‘ä½ çš„è…¦è¢‹äº†ï¼",
  "ä½ è…¦å®¹é‡éƒ½å¿«ç‡’å£äº†å§ï¼Ÿ",
  "é€™æ‰é–‹å§‹ï¼Œç‡’è…¦æ‰å‰›é–‹å§‹ï¼",
  "è¼¸äº†å¯åˆ¥æ€ªæˆ‘æ²’æé†’ä½ ã€‚",
  "ç­”æ¡ˆéƒ½å¯«åœ¨ç«ç„°è£¡äº†ï¼Œå¿«æ‰¾æ‰¾ï¼"
];

// ==== é¡Œåº«ï¼Œé¡Œå‹ï¼šchoice / bool / text
const questionBank = [
  { type: "choice", question: "å“ªå€‹è¡Œç‚ºèƒ½æœ‰æ•ˆé é˜²æ„Ÿå†’ï¼Ÿ", options: ["å‹¤æ´—æ‰‹", "ç†¬å¤œç©æ‰‹æ©Ÿ", "å°‘å–æ°´", "åƒé›¶é£Ÿ"], answer: "å‹¤æ´—æ‰‹" },
  { type: "choice", question: "ä»¥ä¸‹å“ªå€‹ä¸æ˜¯å¥åº·é£²é£Ÿç¿’æ…£ï¼Ÿ", options: ["å¤šåƒè”¬æœ", "æš´é£²æš´é£Ÿ", "è¦å¾‹é‹å‹•", "ä¿æŒè‰¯å¥½ç¡çœ "], answer: "æš´é£²æš´é£Ÿ" },
  { type: "bool", question: "æ¯å¤©å–è¶³å¤ çš„æ°´æœ‰åŠ©å¥åº·ï¼Ÿ", answer: true },
  { type: "text", question: "å¡«ç©ºï¼šç¶­æŒè‰¯å¥½____å¯ä»¥æ¸›å°‘å£“åŠ›ã€‚", answer: "ç¡çœ " },
  { type: "choice", question: "å“ªç¨®é‹å‹•æœ€é©åˆåˆå­¸è€…ï¼Ÿ", options: ["é«˜å¼·åº¦é–“æ­‡", "å¿«èµ°", "èˆ‰é‡", "æ¥µé™è·‘æ­¥"], answer: "å¿«èµ°" },
  { type: "bool", question: "éé‡å–å«ç³–é£²æ–™ä¸åˆ©å¥åº·ã€‚", answer: true },
  { type: "choice", question: "å“ªç¨®é£Ÿå“æœ‰åŠ©æ–¼è…¸èƒƒè •å‹•ï¼Ÿ", options: ["ç‚¸é›", "è”¬æœ", "ç³–æœ", "é€Ÿé£Ÿ"], answer: "è”¬æœ" },
  { type: "text", question: "å¡«ç©ºï¼š____æ˜¯ç¶­ç”Ÿç´ Cçš„ä¸»è¦ä¾†æºã€‚", answer: "æ°´æœ" },
  { type: "choice", question: "æ¸›å°‘ç„¦æ…®å¯é€éä»€éº¼ï¼Ÿ", options: ["å†¥æƒ³", "çœ‹ææ€–ç‰‡", "ç†¬å¤œ", "å–å’–å•¡å› "], answer: "å†¥æƒ³" },
  { type: "bool", question: "ä¿æŒè‰¯å¥½ç¤¾äº¤æœ‰åŠ©å¿ƒç†å¥åº·ï¼Ÿ", answer: true },
  { type: "choice", question: "ä»¥ä¸‹å“ªå€‹è¡Œç‚ºå¯èƒ½å°è‡´è‚¥èƒ–ï¼Ÿ", options: ["å¤šé‹å‹•", "æš´é£²æš´é£Ÿ", "å‡è¡¡é£²é£Ÿ", "æ—©ç¡æ—©èµ·"], answer: "æš´é£²æš´é£Ÿ" },
  { type: "text", question: "å¡«ç©ºï¼šæ¯å¤©è‡³å°‘____åˆ†é˜çš„é‹å‹•å°å¥åº·æœ‰ç›Šã€‚", answer: "30" },
  { type: "choice", question: "å“ªç¨®é£²æ–™è¼ƒä¸åˆ©å¥åº·ï¼Ÿ", options: ["ç¶ èŒ¶", "å¯æ¨‚", "ç™½é–‹æ°´", "èœ‚èœœæ°´"], answer: "å¯æ¨‚" },
  { type: "bool", question: "é©åº¦ä¼‘æ¯èƒ½æé«˜å·¥ä½œæ•ˆç‡ã€‚", answer: true },
  { type: "choice", question: "ä»¥ä¸‹å“ªç¨®é£Ÿå“å«é«˜è„‚è‚ªï¼Ÿ", options: ["å …æœ", "è–¯æ¢", "ç‡•éº¥", "è˜‹æœ"], answer: "è–¯æ¢" },
  { type: "text", question: "å¡«ç©ºï¼šå¤šåƒ____æœ‰åŠ©è£œå……è†³é£Ÿçº–ç¶­ã€‚", answer: "è”¬èœ" },
  { type: "choice", question: "å“ªå€‹è¡Œç‚ºæœ‰åŠ©æ–¼è‰¯å¥½ç¡çœ ï¼Ÿ", options: ["ç¡å‰æ»‘æ‰‹æ©Ÿ", "æ³¡ç†±æ°´æ¾¡", "å–å’–å•¡", "æ™šåƒå¤§é¤"], answer: "æ³¡ç†±æ°´æ¾¡" },
  { type: "bool", question: "æ¯å¤©æ›¬å¤ªé™½æœ‰åŠ©æ–¼ç¶­ç”Ÿç´ Dåˆæˆï¼Ÿ", answer: true },
  { type: "choice", question: "ä»¥ä¸‹å“ªå€‹ä¸å±¬æ–¼å£“åŠ›ç®¡ç†æ–¹æ³•ï¼Ÿ", options: ["å†¥æƒ³", "é‹å‹•", "ç†¬å¤œ", "æ·±å‘¼å¸"], answer: "ç†¬å¤œ" },
  { type: "text", question: "å¡«ç©ºï¼š____å¯å¹«åŠ©è‚Œè‚‰æ”¾é¬†èˆ‡æ¢å¾©ã€‚", answer: "ä¼¸å±•" },
];

// ==== éŠæˆ²ç‹€æ…‹ ====
let currentIndex = 0;
let score = 0;
let wrongCount = 0;
let timeLeft = 45;
let timer = null;
let freeze = false;

// æŠ½å‡ºæœ¬æ¬¡éŠæˆ²é¡Œç›®ï¼Œéš¨æ©Ÿ 6 é¡Œ
let gameQuestions = [];
function pickQuestions() {
  const shuffled = [...questionBank].sort(() => 0.5 - Math.random());
  gameQuestions = shuffled.slice(0, 6);
}
pickQuestions();

// === èªéŸ³æœ—è®€ BOSS ===
function bossSpeak(text) {
  if (!('speechSynthesis' in window)) return;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = 'zh-TW';
  utter.pitch = 0.5 + Math.random() * 0.3;
  utter.rate = 0.9 + Math.random() * 0.4;
  utter.volume = 0.7;
  speechSynthesis.cancel();
  speechSynthesis.speak(utter);
}

// === BOSS å˜²è«·éš¨æ©ŸæŒ‘é¸ ===
function getBossLine() {
  if (wrongCount >= 2) {
    return "ä½ å¿«ç‡’å£è…¦è¢‹äº†å§ï¼Ÿåˆ¥å†ä¸Ÿè‡‰äº†ï¼";
  }
  if (score >= 20) {
    return "é‚„ä¸éŒ¯å˜›ï¼Œä½†åˆ¥é«˜èˆˆå¤ªæ—©ï¼";
  }
  return bossLines[Math.floor(Math.random() * bossLines.length)];
}

// === æ›´æ–° BOSS å°è©±èˆ‡èªéŸ³ ===
function updateBoss() {
  const line = getBossLine();
  const bossDiv = document.getElementById("boss");
  bossDiv.textContent = "ğŸ‘¿ BOSSï¼š" + line;
  bossSpeak(line);
}

// === é¡Œç›®é¸é …æ“¾äº‚ï¼Œéš¨æ©Ÿæ’åˆ—ï¼Œä¸¦å¾®èª¿é¸é …æ–‡å­— ===
function shuffleOptions(opts) {
  const modified = opts.map(opt => {
    if (Math.random() < 0.3) {
      return opt.replace(/å¥åº·/g, "è¡›ç”Ÿ").replace(/è‰¯å¥½/g, "æ­£å¸¸");
    }
    return opt;
  });
  for (let i = modified.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [modified[i], modified[j]] = [modified[j], modified[i]];
  }
  return modified;
}

// === é¡¯ç¤ºé¡Œç›® ===
function showQuestion() {
  if (currentIndex >= gameQuestions.length) currentIndex = 0;
  freeze = false;
  clearInterval(timer);
  timeLeft = 45;
  timer = setInterval(updateTimer, 1000);

  updateBoss();

  const q = gameQuestions[currentIndex];
  document.getElementById("message").textContent = "";
  document.getElementById("scoreBox").textContent = `åˆ†æ•¸ï¼š${score} | éŒ¯èª¤æ¬¡æ•¸ï¼š${wrongCount}/3`;
  document.getElementById("question").textContent = q.question;

  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";
  const inputArea = document.getElementById("inputArea");
  inputArea.style.display = "none";
  document.getElementById("textAnswer").value = "";

  if (q.type === "choice") {
    const opts = shuffleOptions(q.options);
    opts.forEach(opt => {
      const btn = document.createElement("button");
      btn.className = "option";
      btn.textContent = opt;
      btn.onclick = () => checkAnswer(opt);
      optionsDiv.appendChild(btn);
    });
  } else if (q.type === "bool") {
    ["æ˜¯", "å¦"].forEach(val => {
      const btn = document.createElement("button");
      btn.className = "option";
      btn.textContent = val;
      btn.onclick = () => checkAnswer(val === "æ˜¯");
      optionsDiv.appendChild(btn);
    });
  } else if (q.type === "text") {
    inputArea.style.display = "block";
  }

  // ç§»é™¤é–ƒçˆèƒŒæ™¯class
  document.getElementById("game").classList.remove("countdown");
}

// === è¨ˆæ™‚å™¨æ›´æ–° ===
function updateTimer() {
  timeLeft--;
  const gameDiv = document.getElementById("game");
  if (timeLeft <= 10) {
    gameDiv.classList.add("countdown");
  } else {
    gameDiv.classList.remove("countdown");
  }
  document.getElementById("timer").textContent = `å‰©é¤˜æ™‚é–“ï¼š${timeLeft}ç§’`;
  if (timeLeft <= 0) {
    clearInterval(timer);
    handleAnswer(false, true);
  }
}

// === é€å‡ºå¡«ç©ºé¡Œç­”æ¡ˆ ===
function submitTextAnswer() {
  if (freeze) return;
  const q = gameQuestions[currentIndex];
  const input = document.getElementById("textAnswer").value.trim();
  handleAnswer(input === q.answer);
}

// === æª¢æŸ¥é¸é …ç­”æ¡ˆ ===
function checkAnswer(selected) {
  if (freeze) return;
  const q = gameQuestions[currentIndex];
  let correct = false;
  if (q.type === "choice" || q.type === "text") {
    correct = selected === q.answer;
  } else if (q.type === "bool") {
    correct = selected === q.answer;
  }
  handleAnswer(correct);
}

// === ç­”é¡Œçµæœè™•ç† ===
function handleAnswer(isCorrect, timeout = false) {
  freeze = true;
  clearInterval(timer);

  const gameDiv = document.getElementById("game");
  const bossDiv = document.getElementById("boss");

  if (isCorrect) {
    score += 5;
    showMessage("âœ”ï¸ æ­£ç¢ºï¼+5åˆ†", "green", false, true);
  } else {
    score -= 16;
    wrongCount++;
    showMessage(timeout ? "âŒ› è¶…æ™‚ -16åˆ†" : "âŒ éŒ¯èª¤ -16åˆ†", "red", true, false);
    playLaughSound();
  }
  document.getElementById("scoreBox").textContent = `åˆ†æ•¸ï¼š${score} | éŒ¯èª¤æ¬¡æ•¸ï¼š${wrongCount}/3`;
  updateBoss();

  if (wrongCount >= 3) {
    setTimeout(() => {
      alert("ä½ è¼¸äº†ï¼å³å°‡é‡å›ç¬¬ä¸€é—œï¼Œé‡æ–°æŒ‘æˆ°å§ï¼");
      window.location.href = "index1.html"; // å¤±æ•—å¼·åˆ¶å›ç¬¬ä¸€é—œ
    }, 1500);
    return;
  }

  setTimeout(() => {
    currentIndex++;
    showQuestion();
  }, isCorrect ? 1500 : 3500);
}

// === é¡¯ç¤ºè¨Šæ¯ ===
function showMessage(text, color, isError = false, isSuccess = false) {
  const msg = document.getElementById("message");
  msg.textContent = text;
  msg.style.color = color;

  const gameDiv = document.getElementById("game");
  const bossDiv = document.getElementById("boss");

  if (isError) {
    gameDiv.classList.add("shakeBlur");
    bossDiv.classList.add("fireBurst");
    setTimeout(() => {
      gameDiv.classList.remove("shakeBlur");
      bossDiv.classList.remove("fireBurst");
    }, 1500);
  }

  if (isSuccess) {
    launchConfetti();
  }
}

// === æ’­æ”¾å˜²ç¬‘éŸ³æ•ˆ ===
function playLaughSound() {
  const audio = new Audio("https://actions.google.com/sounds/v1/human_voices/laugh_female.ogg");
  audio.volume = 0.3;
  audio.play();
}

// === å½©å¸¶çˆ†è£‚ç‰¹æ•ˆ ===
function launchConfetti() {
  const gameDiv = document.getElementById("game");
  for (let i = 0; i < 20; i++) {
    const confetti = document.createElement("div");
    confetti.className = "confetti";
    confetti.style.left = Math.random() * gameDiv.clientWidth + "px";
    confetti.style.top = "0px";
    confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 80%, 65%)`;
    gameDiv.appendChild(confetti);
    confetti.addEventListener("animationend", () => confetti.remove());
  }
}

// ==== é–‹å§‹éŠæˆ² ====
showQuestion();
</script>
</body>
</html>
